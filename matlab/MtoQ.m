function qa = MtoQ(M)
        
    test =[ M(1,1)+M(2,2)+M(3,3);
            M(1,1)-M(2,2)-M(3,3);
           -M(1,1)+M(2,2)-M(3,3);
           -M(1,1)-M(2,2)+M(3,3);];
    [m, i] = max(test);

    switch(i)
        case 1            
                s = 2*sqrt(1.+M(1,1)+M(2,2)+M(3,3));
                q = [ s/4.;
                    (M(2,3)-M(3,2))/s;
                    (M(3,1)-M(1,3))/s;
                    (M(1,2)-M(2,1))/s;];
                
        case 2            
                s = 2*sqrt(1.+M(1,1)-M(2,2)-M(3,3));
                q = [(M(3,2)-M(2,3))/s;
                        -s/4.;
                     -(M(2,1)+M(1,2))/s;
                     -(M(1,3)+M(3,1))/s;];
        case 3            
                s = 2*sqrt(1.-M(1,1)+M(2,2)-M(3,3));
                q = [(M(1,3)-M(3,1))/s;
                     -(M(2,1)+M(1,2))/s;
                        -s/4.;
                     -(M(3,2)+M(2,3))/s;];
        case 4            
                s = 2*sqrt(1.-M(1,1)-M(2,2)+M(3,3));
                q = [(M(2,1)-M(1,2))/s;
                     -(M(1,3)+M(3,1))/s;
                     -(M(3,2)+M(2,3))/s;
                     -s/4.;];
                 

    end
    
    qa = [q(2),q(3),q(4),q(1)];
    if q(1)<0
        qa = -qa;
    end
end